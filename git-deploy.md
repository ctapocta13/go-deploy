# git-deploy

## Цель

Автоматизировать выкладку изменений по задачам из версии dev на боевую

## Логика работы

Пользователь запускает команду вида

```sh
git-deploy -project=project_name -task=task_number
```

* Программа ищет в папке запуска папку project_name и переходит в нее
* Выполняет в ней `git log --pretty=oneline` и определяет commit_id
* Получает из коммита с найденным commit_id список затронутых файлов `git diff-tree --no-commit-id --name-only -r commit_id`
* Берем в папке файл с настройками в удобной нам форме (json, yml, ini)
* По полученному списку файлов:
  * Смотрим в целевой папке (получается из настроек, может быть локальной или удаленной) дату модификации файла
  * Если файла нет - копируем
  * Если дата модификации раньше аналогичного файла в папке с проектом - делаем его копию *.bak и заменяем его из папки с проектом
  * Если позднее - выводим сообщение, что файл не перенесен
  * Предусмотреть в настройках частный случай, когда файлы из папок src переносятся не сами, а их собранные версии. Куда переносить тоже можно брать в настройках
  * Предусмотреть возможность запуска миграций (из специальной папки migration (путь брать из настроек) файлы запускаются в корне целевого проекта. Название должно совпадать с номером задачи)

## Пример вывода git log --pretty=oneline

```sh
ae71608d2b5bfb91a90e4bb9d8011e8a4c5bab27 (HEAD -> master, origin/master) 204308: Правки SEO
9fbad0b8be31e557e00fde6f76cc1d50900ffaef Незакоммиченое
da4c3e74c75d9cf1b58610a3d8818cf3d866dd90 203056: Правки SEO
288c0a348476f6d91b0cab54f1bb514abeeccd2d 202462: Правки SEO
0edc41082e730c5f1b07ef7825b4328a7528c316 200970: Правка canonical
e050216686a41fb760bee4a694ba3ae85307f99c 200611 Искажение изображения в новостях
25e06fb3b68bc42bb47cacb4688c3ee590263533 Обновление с рабочего хостинга
6d08630daaec17e66e47d5f3f07f636486e414ec 199931 Скрыть разделы
187b9ea4e97a0d8f6331d4b014822eccca2759aa 197723: убран градиент с баннеров на главной
82893370fdad113b03bd1024b42e893f0dde44d7 197723: правка цвета текста в баннере
ee8a85fdee2c951cf5828c698b2af28b4d2ec384 195456: SEO-правки
6f29ea474a75a25f2e8a6c3064cee3a143a0732d Создание репозитория
```

## Пример вывода git diff-tree --no-commit-id --name-only -r ae71608d2b5bfb91a90e4bb9d8011e8a4c5bab27

```sh
www/local/templates/mirrey/components/bitrix/news.detail/front_company/style.css
www/local/templates/mirrey/components/bitrix/news.detail/front_company/template.php
```
